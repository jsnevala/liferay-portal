@component-name = "portal-wcm"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Site Administration";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.tearDownCP();

			Site.tearDownCP();
		}
	}

	@priority = "3"
	test DisplayMySitesPagination {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		for (var number : list "01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24") {
			ProductMenu.gotoPortlet(
				category = "Sites",
				panel = "Control Panel",
				portlet = "Sites"
			);

			Site.addBlankCP(siteName = "Site Name ${number}");
		}

		Navigator.openURL();

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Portlet.addPG(portletName = "My Sites");

		Navigator.gotoPage(pageName = "Test Page");

		Pagination.viewResults(results = "Showing 1 to 20 of 25 entries.");

		Pagination.changePagination(itemsPerPage = "5");

		Pagination.viewResults(results = "Showing 1 to 5 of 25 entries.");
	}

	@priority = "4"
	test JoinSiteOpen {
		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		UserBar.gotoDashboard();

		Site.joinViaMySitesPG(siteName = "Site Name");

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "test@liferay.com",
			userScreenName = "usersn"
		);
	}

	@priority = "5"
	test JoinSitePrivateNo {
		property portal.acceptance = "true";

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(membershipType = "Private", siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		UserBar.gotoDashboard();

		Site.joinViaMySitesPG(membershipType = "Private", siteName = "Site Name");

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "test@liferay.com",
			userScreenName = "usersn"
		);
	}

	@priority = "5"
	test JoinSiteRestricted {
		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(membershipType = "Restricted", siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		UserBar.gotoDashboard();

		Site.joinViaMySitesPG(membershipType = "Restricted", siteName = "Site Name");

		UserBar.gotoDashboard();

		Navigator.gotoNavItem(navItem = "Available Sites");

		MySites.viewMembershipRequested(siteName = "Site Name");

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "test@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoSite(site = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Members",
			panel = "Site Administration",
			portlet = "Site Memberships"
		);

		Site.approveJoinSiteRestrictedViaMySitesPG(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		UserBar.gotoDashboard();

		Site.viewMySitesViaMySitesPG(memberCount = "2", siteName = "Site Name");

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "test@liferay.com",
			userScreenName = "usersn"
		);
	}

	@priority = "5"
	test LeaveSite {
		property portal.acceptance = "true";

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		UserBar.gotoDashboard();

		Site.joinViaMySitesPG(siteName = "Site Name");

		UserBar.gotoDashboard();

		Site.leaveViaMySitesPG(siteName = "Site Name");

		User.logoutPG();

		User.loginPG(
			password = "test",
			userEmailAddress = "test@liferay.com",
			userScreenName = "usersn"
		);
	}

	@priority = "4"
	test SearchSite {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		Page.add(pageName = "Site Page", siteName = "Site Name");

		Navigator.gotoPage(pageName = "Test Page");

		Portlet.addPG(portletName = "My Sites");

		Site.searchInputCP(siteName = "Site Name");

		Site.viewMySitesViaMySitesPG(memberCount = "1", siteName = "Site Name");
	}

	@priority = "3"
	test ViewMembershipAssignViaSiteCP {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Members",
			panel = "Site Administration",
			portlet = "Site Memberships"
		);

		Site.assignUserAsMemberCP(
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.assignRegularRoleCP(roleName = "Power User", userScreenName = "usersn");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		Page.add(pageName = "Public Page", siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		Site.assignUserSitesCP(siteName = "Site Name", userScreenName = "usersn");

		Navigator.openURL();

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Portlet.addPG(portletName = "My Sites");

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		Navigator.gotoPage(pageName = "Test Page");

		Site.viewMySitesViaMySitesPG(memberCount = "2", siteName = "Site Name");
	}

	@priority = "3"
	test ViewNoInactiveSite {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		ProductMenu.gotoSite(site = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Site Administration",
			portlet = "Site Settings"
		);

		Site.inactivateCP(siteName = "Site Name");

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Navigator.gotoPage(pageName = "Test Page");

		Portlet.addPG(portletName = "My Sites");

		Site.searchInputCP(siteName = "Site Name");

		Site.viewNoMySitesViaMySitesPG(memberCount = "1", siteName = "Site Name");
	}

	@priority = "3"
	test ViewNoJoinOption {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Members",
			panel = "Site Administration",
			portlet = "Site Memberships"
		);

		Site.assignUserAsMemberCP(
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.assignRegularRoleCP(roleName = "Administrator", userScreenName = "usersn");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		Page.add(pageName = "Public Page", siteName = "Site Name");

		Site.manageMembershipOptions(allowManualMembershipManagement = "false");

		Navigator.openURL();

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Portlet.addPG(portletName = "My Sites");

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		Navigator.gotoPage(pageName = "Test Page");

		MySites.viewNoOptions(navItem = "Available Sites", siteName = "Site Name");
	}

	@priority = "3"
	test ViewNoLeaveOption {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		Page.add(pageName = "Public Page", siteName = "Site Name");

		Site.manageMembershipOptions(allowManualMembershipManagement = "false");

		Navigator.openURL();

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Navigator.gotoPage(pageName = "Test Page");

		Portlet.addPG(portletName = "My Sites");

		Site.searchInputCP(siteName = "Site Name");

		MySites.viewNoOptions(itemName = "Leave", siteName = "Site Name");
	}

	@priority = "3"
	test ViewSitePages {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		Page.add(pageName = "Public Page", siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Page.add(
			pageName = "Private Page",
			siteName = "Site Name",
			sitePagePrivacy = "Private"
		);

		Navigator.gotoPage(pageName = "Test Page");

		Portlet.addPG(portletName = "My Sites");

		MySites.gotoPagesPG(
			menuItem = "Go to Public Pages",
			pageName = "Public Page",
			siteName = "Site Name"
		);

		Navigator.gotoPage(pageName = "Test Page");

		MySites.gotoPagesPG(
			menuItem = "Go to Private Pages",
			pageName = "Private Page",
			siteName = "Site Name"
		);
	}

	@priority = "4"
	test ViewSiteWithTags {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		ProductMenu.gotoSite(site = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Site Administration",
			portlet = "Site Settings"
		);

		for (var tagName : list "apple,banana,mango") {
			Tag.addViaSiteCP(tagName = "${tagName}");
		}

		Page.add(pageName = "Test Page", siteName = "${siteName}");

		Navigator.gotoPage(pageName = "Test Page");

		Portlet.addPG(portletName = "My Sites");

		Site.viewMySitesViaMySitesPG(memberCount = "1", siteName = "Site Name");

		for (var tagName : list "apple,banana,mango") {
			MySites.viewTags(tagName = "${tagName}");
		}
	}
}