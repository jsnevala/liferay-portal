@component-name = "portal-social-networking"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property custom.properties = "default.layout.template.id=1_column";
	property testray.main.component.name = "Social Networking";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			// There is no need for a SocialActivity#tearDownCP, as the User Statistics will not be reset and Jenkins does not run teardowns.

			User.firstLoginPG();

			User.tearDownCP();

			BlogsEntry.tearDownCP();

			Polls.tearDownCP();

			Page.tearDownPG();
		}
	}

	@priority = "4"
	test BlogsDemo {
		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Site Administration",
			portlet = "Social Activity"
		);

		SocialActivity.enableBlogsCP();

		SocialActivity.configureActionCP(
			contributionIncrement = "2",
			contributionLimitValue = "2",
			participationIncrement = "2",
			participationLimitValue = "2",
			userAction = "Adds a Comment"
		);

		SocialActivity.removeActionCP(userAction = "Reads a Blog");

		SocialActivity.removeActionCP(userAction = "Subscribes to a Blog");

		SocialActivity.configureActionCP(
			participationIncrement = "0",
			userAction = "Votes on a Blog"
		);

		Page.add(pageName = "Social Activity Page");

		Navigator.gotoPage(pageName = "Social Activity Page");

		Portlet.addPG(portletName = "User Statistics");

		var key_portletName = "User Statistics";

		AssertTextEquals(
			locator1 = "Portlet#BODY",
			value1 = "There are no active users for this period."
		);

		Page.add(pageName = "Blogs Page");

		Navigator.gotoPage(pageName = "Blogs Page");

		Portlet.addPG(portletName = "Blogs");

		Blogs.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		Navigator.gotoPage(pageName = "Social Activity Page");

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 0 (Total: 0)",
			participationScore = "Participation Score: 5 (Total: 5)",
			userName = "Test Test",
			userRank = "Rank: 1"
		);

		Navigator.gotoPage(pageName = "Blogs Page");

		BlogsNavigator.gotoEntryPG(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		BlogsEntryComment.add(entryComment = "Blogs Entry Comment 1");

		Navigator.gotoPage(pageName = "Social Activity Page");

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 0 (Total: 0)",
			participationScore = "Participation Score: 7 (Total: 7)",
			userName = "Test Test",
			userRank = "Rank: 1"
		);

		Navigator.gotoPage(pageName = "Blogs Page");

		BlogsNavigator.gotoEntryPG(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		BlogsEntryComment.add(entryComment = "Blogs Entry Comment 2");

		Navigator.gotoPage(pageName = "Social Activity Page");

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 0 (Total: 0)",
			participationScore = "Participation Score: 9 (Total: 9)",
			userName = "Test Test",
			userRank = "Rank: 1"
		);

		User.logoutPG();

		User.loginPG(userEmailAddress = "userea@liferay.com");

		Navigator.gotoPage(pageName = "Blogs Page");

		BlogsNavigator.gotoEntryPG(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		BlogsEntryComment.add(entryComment = "Blogs Entry Comment from userfn");

		Navigator.gotoPage(pageName = "Social Activity Page");

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 2 (Total: 2)",
			participationScore = "Participation Score: 9 (Total: 9)",
			userName = "Test Test",
			userRank = "Rank: 1"
		);

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 0 (Total: 0)",
			participationScore = "Participation Score: 2 (Total: 2)",
			userName = "userfn userln",
			userRank = "Rank: 2"
		);

		User.logoutAndLoginPG(
			userLoginEmailAddress = "test@liferay.com",
			userLoginFullName = "Test Test"
		);

		Navigator.gotoPage(pageName = "Blogs Page");

		BlogsNavigator.gotoEntryPG(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		BlogsEntryComment.add(entryComment = "Blogs Entry Comment 3");

		Navigator.gotoPage(pageName = "Social Activity Page");

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 2 (Total: 2)",
			participationScore = "Participation Score: 9 (Total: 9)",
			userName = "Test Test",
			userRank = "Rank: 1"
		);

		SocialActivity.viewPGViaUserStatistics(
			contributionScore = "Contribution Score: 0 (Total: 0)",
			participationScore = "Participation Score: 2 (Total: 2)",
			userName = "userfn userln",
			userRank = "Rank: 2"
		);
	}

	@priority = "4"
	test Localization {
		property test.name.skip.portal.instance = "SocialactivityUsecase#Localization";

		Page.add(pageName = "Social Activity Page");

		Navigator.gotoPage(pageName = "Social Activity Page");

		Portlet.addPG(portletName = "Language Selector");

		ProductMenuHelper.expandPanel(panel = "Control Panel");

		LanguagePortlet.selectLanguagePG(language = "French (France)");

		Navigator.gotoPage(pageName = "Social Activity Page");

		Page.gotoSALocalizedCP(
			adminLocalized = "Administration du portail",
			portletCategoryName = "Paramètres",
			portletName = "Activité sociale"
		);

		AssertVisible(locator1 = "Portlet#HEADER");

		Navigator.gotoPage(pageName = "Social Activity Page");

		LanguagePortlet.selectLanguagePG(language = "Japanese (Japan)");

		Page.gotoSALocalizedCP(
			adminLocalized = "システム管理",
			portletCategoryName = "設定",
			portletName = "ソーシャルアクティビティ"
		);

		AssertVisible(locator1 = "Portlet#HEADER");

		Navigator.gotoPage(pageName = "Social Activity Page");

		LanguagePortlet.selectLanguagePG(language = "Portuguese (Brazil)");

		Page.gotoSALocalizedCP(
			adminLocalized = "Administração",
			portletCategoryName = "Configuração",
			portletName = "Atividade Social"
		);

		AssertVisible(locator1 = "Portlet#HEADER");

		Navigator.gotoPage(pageName = "Social Activity Page");

		LanguagePortlet.selectLanguagePG(language = "English (United States)");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Site Administration",
			portlet = "Social Activity"
		);

		Page.gotoMyAccount(portletName = "Account Settings");

		AssertSelectedLabel(
			locator1 = "MyAccount#LANGUAGE_SELECT",
			value1 = "English (United States)"
		);
	}

	@priority = "4"
	test SaveUserStatisticsConfiguration {
		Page.add(pageName = "User Statistics Page");

		Navigator.gotoPage(pageName = "User Statistics Page");

		Portlet.addPG(portletName = "User Statistics");

		var key_portletName = "User Statistics";

		AssertTextEquals(
			locator1 = "Portlet#BODY",
			value1 = "There are no active users for this period."
		);

		Portlet.gotoPortletOptions(
			portletName = "User Statistics",
			portletOption = "Configuration"
		);

		SelectFrame(locator1 = "UserStatisticsConfiguration#CONFIGURATION_IFRAME");

		Uncheck(locator1 = "Checkbox#RANK_BY_CONTRIBUTION");

		Uncheck(locator1 = "Checkbox#RANK_BY_PARTICIPATION");

		Uncheck(locator1 = "Checkbox#SHOW_HEADER_TEXT");

		Uncheck(locator1 = "Checkbox#SHOW_TOTALS");

		Uncheck(locator1 = "Checkbox#DISPLAY_ADDITIONAL_ACTIVITY_COUNTERS");

		PortletEntry.save();

		SelectFrameTop(value1 = "relative=top");

		Navigator.gotoPage(pageName = "User Statistics Page");

		Portlet.gotoPortletOptions(
			portletName = "User Statistics",
			portletOption = "Configuration"
		);

		IFrame.selectDialogFrame();

		AssertNotChecked(locator1 = "Checkbox#RANK_BY_CONTRIBUTION");

		AssertNotChecked(locator1 = "Checkbox#RANK_BY_PARTICIPATION");

		AssertNotChecked(locator1 = "Checkbox#SHOW_HEADER_TEXT");

		AssertNotChecked(locator1 = "Checkbox#SHOW_TOTALS");

		AssertNotChecked(locator1 = "Checkbox#DISPLAY_ADDITIONAL_ACTIVITY_COUNTERS");

		SelectFrameTop(value1 = "relative=top");
	}

	@priority = "4"
	test ViewActivityViaGroupStatistics {
		Page.add(pageName = "Group Statistics Page");

		Navigator.gotoPage(pageName = "Group Statistics Page");

		Portlet.addPG(portletName = "Group Statistics");

		var key_portletName = "Group Statistics";

		AssertTextEquals(
			locator1 = "Portlet#BODY",
			value1 = "Please configure this portlet and select at least one activity counter."
		);

		SocialActivity.updateGroupStatisticsConfiguration(
			chartType = "column diagram",
			chartWidth = "55%",
			dataRange = "last 12 months",
			displayActivityCounterName = "blog entries of This site&apos;s users"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Site Administration",
			portlet = "Social Activity"
		);

		SocialActivity.enableBlogsCP();

		Navigator.openURL();

		for (var entryCount : list "1,2,3") {
			Navigator.openURL();

			ProductMenu.gotoPortlet(
				category = "Content",
				panel = "Site Administration",
				portlet = "Blogs"
			);

			Blogs.addEntry(
				entryContent = "Blogs Entry${entryCount} Content",
				entryTitle = "Blogs Entry${entryCount} Title"
			);
		}

		Navigator.gotoPage(pageName = "Group Statistics Page");

		SocialActivity.viewPGViaGroupStatistics(
			currentValue = "3",
			siteStatistics = "Users&apos; Blog Entries"
		);
	}
}