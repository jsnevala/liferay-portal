@component-name = "portal-portal-services"
@ignore = "true"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property portlet.plugins.includes = "sample-drools-portlet";
	property testray.main.component.name = "Development Tools";
	property web.plugins.includes = "drools-web";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.logoutAndLoginPG(
				userLoginEmailAddress = "test@liferay.com",
				userLoginFullName = "Test Test"
			);

			Page.tearDownPG();

			User.tearDownCP();

			WebContent.tearDownCP();

			WebContentTemplates.tearDownCP();

			WebContentStructures.tearDownCP();
		}
	}

	@priority = "4"
	test SampleDroolsDemo {
		var structureDescription = "WC Structure Description";
		var structureFieldNames = "Text,Image";
		var structureName = "WC Structure Name";
		var templateDescription = "WC Template Description";
		var templateName = "WC Template Name";
		var webContentImage = "Document_2.jpeg";
		var webContentText = "WC WebContent Text";
		var webContentTitle = "WC WebContent Title";

		Page.gotoMyAccount(portletName = "Addresses");

		User.addAddressViaMyAccount(
			userAddressCountry = "United States",
			userAddressPostalCode = "91789",
			userAddressRegion = "California",
			userAddressStreet1 = "1220 Brea Canyon Rd",
			userAddressType = "Business"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoManageStructures();

		WebContentStructures.addCP(
			structureDescription = "WC Structure Description",
			structureName = "WC Structure Name"
		);

		for (var structureFieldName : list "Text,Image") {
			DynamicDataMapping.addField(
				field = "${structureFieldName}",
				fieldFieldLabel = "${structureFieldName}",
				fieldName = StringUtil.replace("${structureFieldName}", " ", "")
			);
		}

		WebContentStructures.saveCP(structureName = "WC Structure Name");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoManageTemplates();

		WebContentTemplates.addCP(
			templateDescription = "${templateDescription}",
			templateLanguage = "ftl",
			templateName = "${templateName}"
		);

		WebContentTemplates.addStructure(
			structureName = "${structureName}",
			templateFieldNames = "${structureFieldNames}",
			templateLanguage = "ftl"
		);

		DDLDataDefinition.save();

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContent.addWithStructureCP(
			structureName = "${structureName}",
			templateName = "${templateName}",
			webContentImage = "${webContentImage}",
			webContentText = "${webContentText}",
			webContentTitle = "${webContentTitle}"
		);

		PortletEntry.publish();

		WebContent.viewTitle(webContentTitle = "${webContentTitle}");

		Page.add(pageName = "WC Page");

		Portlet.addPG(pageName = "WC Page", portletName = "Web Content Display");

		WebContentDisplayPortlet.selectWebContent(
			webContentTitle = "${webContentTitle}"
		);

		WebContentNavigator.gotoEditPGViaWCD();

		WebContent.addTagPGViaWCD(tagName = "european");

		Page.add(pageName = "Drools Page");

		Portlet.addPG(pageName = "Drools Page", portletName = "Sample Drools");

		Drools.viewDefaultPG(welcomeMessage = "Welcome Test Test!");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			password = "password",
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Members",
			panel = "Site Administration",
			portlet = "Site Memberships"
		);

		Site.assignUserAsMemberCP(
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.assignSiteRoleCP(
			siteRoleName = "Site Administrator",
			userScreenName = "usersn"
		);

		User.logoutAndLoginPG(
			userLoginEmailAddress = "userea@liferay.com",
			userLoginFullName = "userfn userln"
		);

		Page.gotoMyAccount(portletName = "Addresses");

		User.addAddressViaMyAccount(
			userAddressCountry = "Germany",
			userAddressPostalCode = "91789",
			userAddressRegion = "Berlin",
			userAddressStreet1 = "1220 Brea Canyon Rd",
			userAddressType = "Business"
		);

		Navigator.gotoPage(pageName = "Drools Page");

		Drools.viewContentPG(
			droolsContent = "${webContentText}",
			screenshotFileName = "web_content_image_field.png",
			welcomeMessage = "Welcome userfn userln!"
		);
	}
}