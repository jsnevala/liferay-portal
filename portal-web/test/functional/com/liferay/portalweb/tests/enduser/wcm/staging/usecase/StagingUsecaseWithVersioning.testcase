@component-name = "portal-staging"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Staging";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Page.add(pageName = "Staging Test Page", siteName = "Site Name");

		Navigator.openSiteURL(siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Publishing",
			panel = "Site Administration",
			portlet = "Staging"
		);

		Staging.activateStagingCP(
			pageVersioningEnabled = "true",
			siteName = "Site Name"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Site.tearDownCP();
		}
	}

	@priority = "4"
	test DeleteChildPageFromVariationWhereNotEnabled {
		Staging.addSitePagesVariationPG(
			copySitePagesVariationName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Page.addChild(
			page = "Public Pages",
			pageName = "Staging Test Page",
			siteChildPageName = "Page 1",
			siteName = "Site Name",
			siteScopeSelected = "true"
		);

		Staging.changeSitePageVariationPG(
			sitePagesVariationMenulistName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Staging.viewNotAvailableMenuItem(pageName = "Page 1");
	}

	@priority = "4"
	test EnableAndDeleteSitePageVariationPage {
		Staging.addSitePagesVariationPG(
			copySitePagesVariationName = "Main Variation",
			sitePagesVariationName = "Test Site Pages Variation"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Page.add(
			pageName = "Test Page Name",
			pageStaging = "true",
			siteName = "Site Name"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Test Page Name",
			siteName = "Site Name"
		);

		Staging.markAsReadyForPublication();

		Staging.changeSitePageVariationPG(
			sitePagesVariationMenulistName = "Main Variation",
			sitePagesVariationName = "Test Site Pages Variation"
		);

		Staging.enablePageInSitePagesVariation(
			pageName = "Test Page Name",
			sitePagesVariationName = "Main Variation"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Page.deletePG(pageName = "Test Page Name");
	}

	@description = "This is a use case for LPS-78292."
	@priority = "3"
	test PublicationWithoutReadyForPublication {
		Page.add(
			pageName = "Staging Test Page 2",
			pageStaging = "true",
			siteName = "Site Name"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page 2",
			siteName = "Site Name"
		);

		Portlet.addPG(portletName = "Hello World");

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		Staging.addPageVariationPG(pageVariationName = "Page Variation Name");

		Portlet.gotoPortletOptions(
			portletName = "Hello World",
			portletOption = "Look and Feel Configuration"
		);

		Portlet.configureCustomTitleViaLookandfeelPG(portletName = "Hello World");

		PortletEntry.save();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page 2",
			siteName = "Site Name"
		);

		Portlet.viewSpecificPG(portletName = "Hello World Custom");

		Staging.gotoPublishToLive(pleaseDoNotMarkAsReady = "true");

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page 2", siteName = "Site Name");

		Portlet.viewNoSpecificPG(portletName = "Hello World Custom");
	}

	@priority = "3"
	test PublishCustomPortletTitle {
		Staging.addSitePagesVariationPG(
			sitePagesVariationName = "Site Pages Variation Name"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(
			sitePagesVariationName = "Site Pages Variation Name"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.addPG(portletName = "Sites Directory");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.viewSpecificPG(portletName = "Sites Directory");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.gotoPortletOptions(portletOption = "Look and Feel Configuration");

		Portlet.configureCustomTitleViaLookandfeelPG(portletName = "Sites Directory");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.viewSpecificPG(portletName = "Sites Directory Custom");

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		Staging.gotoPublishToLive();

		Staging.configurePublishToLive(
			applicationName = "Sites Directory",
			markAsReadyForPublication = "true"
		);

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		Portlet.viewNoSpecificPG(portletName = "Sites Directory");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		Portlet.viewSpecificPG(portletName = "Sites Directory Custom");
	}

	@priority = "3"
	test StagingBlogsCP {
		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Blogs"
		);

		Blogs.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title"
		);

		ProductMenu.gotoSite(site = "Site Name");

		Navigator.gotoStagedView();

		Staging.gotoPublishToLive();

		Staging.publishToLive();
	}

	@priority = "4"
	test StagingDeletePageVariation {
		property osgi.app.includes = "youtube";
		property plugins.deployment.type = "osgi";

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(sitePagesVariationName = "Main Variation");

		Staging.addPageVariationPG(pageVariationName = "Monday");

		Portlet.addPG(portletName = "Web Content Display");

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.addPageVariationPG(pageVariationName = "Wednesday");

		Portlet.addPG(portletName = "YouTube");

		Staging.deletePageVariationPG(pageVariationName = "Monday");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		AssertElementNotPresent(locator1 = "Staging#PAGE_VARIATION");

		Staging.changePageVariationInHistory(
			pageVariationName = "All Page Variations",
			pageVariationNameMenulistName = "Wednesday"
		);

		Staging.viewHistoryVersionPG(historyVersionName = "Wednesday");

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		AssertElementPresent(locator1 = "Home#PORTLET", key_portletName = "YouTube");

		AssertElementPresent(
			locator1 = "Home#PORTLET",
			key_portletName = "Web Content Display"
		);
	}

	@priority = "4"
	test StagingDeleteSitePagesVariation {
		property osgi.app.includes = "youtube";
		property plugins.deployment.type = "osgi";

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(sitePagesVariationName = "Main Variation");

		Staging.addSitePagesVariationPG(sitePagesVariationName = "Monday");

		Portlet.addPG(portletName = "Web Content Display");

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.addSitePagesVariationPG(sitePagesVariationName = "Wednesday");

		Portlet.addPG(portletName = "YouTube");

		Staging.deleteSitePagesVariationPG(sitePagesVariationName = "Monday");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		AssertElementPresent(locator1 = "Home#PORTLET", key_portletName = "YouTube");

		AssertElementPresent(
			locator1 = "Home#PORTLET",
			key_portletName = "Web Content Display"
		);
	}

	@priority = "3"
	test StagingLogo {
		Page.viewDefaultLogoPG();

		Navigator.openSiteURL(siteName = "Site Name");

		ProductMenu.gotoPublicPages();

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		Page.changeLogoViaPageCP(logoFile = "Document_2.png", page = "Public Pages");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Page.viewCustomLogoPG();

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		Staging.gotoPublishToLive();

		Staging.configurePublishToLive(uncheckLogo = "true");

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		Page.viewDefaultLogoPG();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		Page.viewCustomLogoPG();
	}

	@priority = "4"
	test StagingMergeSitePagesVariation1 {
		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(sitePagesVariationName = "Main Variation");

		Staging.addSitePagesVariationPG(
			copySitePagesVariationName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Staging.changeSitePageVariationPG(
			sitePagesVariationMenulistName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Page.add(pageName = "Page 2");

		Staging.mergeSitePagesVariation(
			sitePagesVariationMergeName = "Summer",
			sitePagesVariationName = "Main Variation"
		);

		Staging.markAsReadyForPublication();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		Navigator.gotoSitePage(pageName = "Page 2", siteName = "Site Name");

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");
	}

	@priority = "4"
	test StagingMergeSitePagesVariation2 {
		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(sitePagesVariationName = "Main Variation");

		Staging.addSitePagesVariationPG(
			copySitePagesVariationName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Portlet.addPG(portletName = "Web Content Display");

		Staging.markAsReadyForPublication();

		Staging.changeSitePageVariationPG(
			sitePagesVariationMenulistName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Page.add(pageName = "Page 2");

		Staging.mergeSitePagesVariation(
			sitePagesVariationMergeName = "Main Variation",
			sitePagesVariationName = "Summer"
		);

		Staging.markAsReadyForPublication();

		Staging.changeSitePageVariationPG(
			sitePagesVariationMenulistName = "Summer",
			sitePagesVariationName = "Main Variation"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.changePageVariationPG(
			pageVariationName = "Main Variation (Main Variation)",
			pageVariationNameMenulistName = "Main Variation"
		);

		Navigator.gotoStagedSitePage(pageName = "Page 2", siteName = "Site Name");

		Staging.enablePageInSitePagesVariation(
			pageName = "Page 2",
			sitePagesVariationName = "Summer"
		);

		Staging.markAsReadyForPublication();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.changePageVariationPG(
			pageVariationName = "Main Variation",
			pageVariationNameMenulistName = "Main Variation (Main Variation)"
		);

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		AssertElementNotPresent(
			locator1 = "Home#PORTLET",
			key_portletName = "Web Content Display"
		);

		Navigator.gotoSitePage(pageName = "Page 2", siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.changePageVariationPG(
			pageVariationName = "Main Variation",
			pageVariationNameMenulistName = "Main Variation"
		);

		Staging.markAsReadyForPublication();

		Staging.gotoPublishToLive();

		Staging.publishToLive();

		ProductMenu.gotoLiveSite();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		AssertElementPresent(
			locator1 = "Home#PORTLET",
			key_portletName = "Web Content Display"
		);
	}

	@priority = "4"
	test StagingPortletPublishContentCount {
		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoAddCP();

		WebContent.addCP(
			webContentContent = "Web Content Content",
			webContentTitle = "Web Content Title"
		);

		PortletEntry.publish();

		WebContent.viewTitle(webContentTitle = "Web Content Title");

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		Staging.viewPublishContentCountViaPortletStagingCP(
			contentCount = "1",
			contentInformation = "Web Content (1)",
			stagingDateRange = "From Last Publish Date"
		);

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		Staging.publishToLiveNowViaPortletCP();

		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedView();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		Staging.viewNoPublishContentCountViaPortletStagingCP(
			stagingDateRange = "From Last Publish Date"
		);
	}

	@priority = "4"
	test StagingPublishLast {
		Navigator.openSiteURL(siteName = "Site Name");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewSitePagesVariationPG(sitePagesVariationName = "Main Variation");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoAddCP();

		WebContent.addCP(
			webContentContent = "Web Content Content",
			webContentTitle = "Web Content Title"
		);

		PortletEntry.publish();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.gotoPublishToLive();

		Staging.configurePublishToLive(
			checkContentNameList = "Web Content",
			contentDateRange = "Last"
		);

		AssertChecked(
			locator1 = "Checkbox#ANY_CHECKBOX",
			value1 = "Web Content",
			checkboxName = "Web Content"
		);

		Staging.publishToLive();

		Navigator.gotoSitePage(pageName = "Staging Test Page", siteName = "Site Name");

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContent.viewTitle(onLive = "true", webContentTitle = "Web Content Title");
	}

	@priority = "5"
	test StagingSiteVariationIncompletePage {
		Staging.addSitePagesVariationPG(
			sitePagesVariationName = "Site Pages Variation Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Page.add(
			pageName = "Test Page Name",
			pageStaging = "true",
			siteName = "Site Name"
		);

		SitePageNavigator.gotoPages(page = "Public Pages", site = "Site Name");

		AssertElementPresent(locator1 = "Staging#STAGING_PUBLISH_TO_LIVE_BUTTON");

		Page.selectSitePagesVariationName(sitePagesVariationName = "Main Variation");

		SitePageNavigator.gotoEditPage(page = "Test Page Name");

		Staging.viewIncompletePageViaStagingPageVariation(
			pageName = "Test Page Name",
			sitePagesVariationName = "Main Variation"
		);
	}

	@description = "This is a use case for LPS-87030."
	@priority = "3"
	test StagingTurnOffPageTemplatePropagation {
		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Page Templates"
		);

		PageTemplate.addCP(
			pageTemplateActive = "Yes",
			pageTemplateName = "Page Template Name"
		);

		PageTemplate.configurePageTemplateLayout(
			columnName = "1 Column",
			pageTemplateName = "Page Template Name"
		);

		Navigator.openStagingSiteURL(siteName = "Site Name");

		Page.add(pageName = "Test Page Name", pageTemplateName = "Page Template Name");

		SitePageNavigator.gotoEditPage(page = "Test Page Name");

		Page.togglePageTemplateInheritChanges(toggleValue = "disable");

		PortletEntry.save();

		SitePageNavigator.gotoEditPage(page = "Test Page Name");

		Page.viewPageLayoutColumn(columnName = "1 Column");
	}

	@priority = "4"
	test StagingVersionHistory {
		Click(locator1 = "Icon#STAGING_BAR_VERTICAL_ELLIPSIS");

		Click(locator1 = "Staging#HISTORY_BUTTON");

		SelectFrame(locator1 = "IFrame#DIALOG");

		var historyVersion = selenium.getText("Staging#HISTORY_VERSION");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.viewHistoryVersionPG(historyVersion = "${historyVersion}");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.addPG(portletName = "Blogs");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.viewSpecificPG(portletName = "Blogs");

		Staging.viewHistoryVersionPG(
			historyVersion = "${historyVersion}",
			modifiedVersion = "true"
		);

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.undoStagingPageVersioningPG();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.viewNoSpecificPG(portletName = "Blogs");

		Staging.viewHistoryVersionPG(historyVersion = "${historyVersion}");

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Staging.redoStagingPageVersioningPG();

		Navigator.gotoStagedSitePage(
			pageName = "Staging Test Page",
			siteName = "Site Name"
		);

		Portlet.viewSpecificPG(portletName = "Blogs");

		Staging.viewHistoryVersionPG(
			historyVersion = "${historyVersion}",
			modifiedVersion = "true"
		);

		Staging.gotoPublishToLive();

		Staging.publishToLive();
	}
}