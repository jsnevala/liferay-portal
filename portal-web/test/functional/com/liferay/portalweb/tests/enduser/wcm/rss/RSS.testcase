@component-name = "portal-rss"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "RSS";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addBlankCP(siteName = "Site Name");

		SitePageNavigator.gotoPages(page = "Public Pages");

		Page.add(pageName = "Site Page Name");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Page.tearDownPG(site = "Liferay");

			Site.tearDownCP();
		}
	}

	@priority = "3"
	test AddFeedBetweenFeeds {
		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Technology",
			feedType = "file",
			feedUrlLink = "Technology.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			buttonRowIndexNumber = "1",
			feedRowIndexNumber = "2",
			feedTitle = "Latimes &gt; Technology News",
			feedType = "file",
			feedUrlLink = "rss2.0.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			buttonRowIndexNumber = "1",
			feedRowIndexNumber = "3",
			feedTitle = "Reuters &gt; Sports News",
			feedType = "file",
			feedUrlLink = "reuters_sports_news.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		for (var feedTitle : list "Technology,Reuters > Sports News,Latimes > Technology News") {
			RSSPortlet.viewDisplayFeedTitle(feedTitle = "${feedTitle}");
		}
	}

	@priority = "4"
	test AddFeedWithWrongUrl {
		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "General Announcement",
			feedUrlLink = "www.theverge.com/rss/index.xml"
		);

		RSSPortlet.viewWarningMessageDisplay(
			errorMessage = "The following are invalid URLs: www.theverge.com/rss/index.xml."
		);

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDeleteFeed(feedTitle = "General Announcement");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "General Announcement",
			feedType = "file",
			feedUrlLink = "theverge.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "General Announcement");
	}

	@priority = "5"
	test AddRSSFeed {
		property portal.acceptance = "true";

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		RSSPortlet.viewPortletConfigurationInfo();

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Latimes &gt; Technology News",
			feedType = "file",
			feedUrlLink = "rss2.0.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Latimes &gt; Technology News");
	}

	@priority = "3"
	test AddWebContentFeed {
		property dummy.socket.proxy.disabled = "true";
		property test.name.skip.portal.instance = "RSS#AddWebContentFeed";

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoAddCP();

		WebContent.addCP(
			webContentContent = "Web Content Content",
			webContentTitle = "Web Content Title"
		);

		PortletEntry.publish();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoAddFeed();

		WebContent.addFeed(
			description = "WC Feed Description",
			feedContent = "Content(ddm-text-html)",
			feedTitle = "WC Feed Title",
			feedType = "RSS 2.0",
			structureName = "Basic Web Content",
			targetFriendlyUrl = "/web/guest/home"
		);

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Web Content"
		);

		WebContentNavigator.gotoEditFeed(feedName = "WC Feed Title");

		var rssFeedUrl = selenium.getAttribute("//input[contains(@id,'JournalPortlet_url') and contains(@value,'journal/rss')]@value");
		var rssFeedUrl = StringUtil.replace("${rssFeedUrl}", "localhost", "127.0.0.1");

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Web Content Feed Title",
			feedUrlLink = "${rssFeedUrl}"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Web Content Feed Title");

		RSSPortlet.viewFeedContent(
			feedEntryContent = "Web Content Content",
			feedEntryTitle = "Web Content Title"
		);
	}

	@priority = "3"
	test ChangeDefaultToNavigationDisplay {
		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Technology",
			feedType = "file",
			feedUrlLink = "Technology.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.configureFeedDisplayStyle(feedDisplayStyle = "Navigation");

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewNavigationDisplayFeedTitle(feedTitle = "Technology");
	}

	@priority = "3"
	test ChangeOrderOfRSSFeeds {
		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Technology",
			feedType = "file",
			feedUrlLink = "Technology.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			buttonRowIndexNumber = "1",
			feedRowIndexNumber = "2",
			feedTitle = "NBA",
			feedType = "file",
			feedUrlLink = "nba.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.viewPG(
			feedRowIndexNumber = "0",
			feedTitle = "Technology",
			rowIndexNumber = "1"
		);

		RSSPortlet.viewPG(
			feedRowIndexNumber = "1",
			feedTitle = "NBA",
			rowIndexNumber = "2"
		);

		RSSPortlet.changeFeedsOrder(
			fromRowNumber = "1",
			rowLocation = "Title",
			toRowNumber = "2"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.viewPG(
			feedRowIndexNumber = "0",
			feedTitle = "NBA",
			rowIndexNumber = "1"
		);

		RSSPortlet.viewPG(
			feedRowIndexNumber = "1",
			feedTitle = "Technology",
			rowIndexNumber = "2"
		);
	}

	@priority = "4"
	test DeleteFeedFromRSS {
		Navigator.gotoPage(pageName = "Welcome");

		Page.add(pageName = "Page Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Latimes &gt; Technology News",
			feedType = "file",
			feedUrlLink = "rss2.0.xml"
		);

		PortletEntry.save();

		Navigator.gotoPage(pageName = "Page Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Latimes &gt; Technology News");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.deleteFeed(buttonRowIndexNumber = "1");

		PortletEntry.save();

		Navigator.gotoPage(pageName = "Page Name");

		RSSPortlet.viewDeleteFeed(feedTitle = "Latimes &gt; Technology News");
	}

	@priority = "3"
	test DisabledFeedTitle {
		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.viewSpecificPG(portletName = "RSS Publisher");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Technology",
			feedType = "file",
			feedUrlLink = "Technology.xml"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Technology");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.disableShowFeedTitle();

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewNoFeedTitle(feedTitle = "Technology");
	}

	@priority = "3"
	test EnableRSSFeedFromAssetpublisher {
		property dummy.socket.proxy.disabled = "true";
		property test.name.skip.portal.instance = "RSS#AddWebContentFeed";

		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		SitePageNavigator.gotoPages(page = "Public Pages", site = "Site Name");

		Page.add(pageName = "Site Page Name 2");

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Navigator.gotoSitePage(pageName = "Site Page Name 2", siteName = "Site Name");

		Portlet.addPG(portletName = "Asset Publisher");

		WebContent.addPGViaAP(
			webContentContent = "This is the web content test for rss feed",
			webContentTitle = "Web Content Title"
		);

		Portlet.gotoPortletOptions(
			portletName = "Asset Publisher",
			portletOption = "Configuration"
		);

		AssetPublisherPortlet.enableRSSSubscription();

		Button.clickSave();

		IFrame.selectTopFrame();

		Navigator.gotoSitePage(pageName = "Site Page Name 2", siteName = "Site Name");

		var rssFeedUrl = selenium.getAttribute("//div[@class='subscribe-action']/span/a[contains(@href,'asset_publisher')]@href");
		var rssFeedUrl = StringUtil.replace("${rssFeedUrl}", "localhost", "127.0.0.1");

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Web Asset Publisher",
			feedUrlLink = "${rssFeedUrl}"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Web Asset Publisher");

		RSSPortlet.openFeed(feedTitle = "Asset Publisher", siteName = "${siteName}");

		AssetPublisherPortlet.viewAssetPG(
			assetContent = "This is the web content test for rss feed",
			assetTitle = "Web Content Title"
		);
	}

	@priority = "4"
	test RemoveRSSPortlet {
		Navigator.gotoPage(pageName = "Welcome");

		Page.add(pageName = "Page Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Portlet.viewSpecificPG(portletName = "RSS Publisher");

		RSSPortlet.viewPortletConfigurationInfo();

		Portlet.deletePG(portletName = "RSS Publisher");

		Navigator.gotoPage(pageName = "Page Name");

		Portlet.viewNoSpecificPG(portletName = "RSS Publisher");
	}

	@priority = "4"
	test UpdateRSSFeedViaAssetpublisher {
		property test.name.skip.portal.instance = "RSS#UpdateRSSFeedViaAssetpublisher";

		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "System Settings"
		);

		SystemSettings.gotoCategory(category = "Web Experience");

		SystemSettings.editConfiguration(configurationName = "RSS Cache");

		RSSPortlet.updateFeedTime(feedTime = "1");

		SitePageNavigator.gotoPages(page = "Public Pages", site = "Site Name");

		Page.add(pageName = "Asset Publisher Page");

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.addPG(portletName = "RSS Publisher");

		Navigator.gotoSitePage(
			pageName = "Asset Publisher Page",
			siteName = "Site Name"
		);

		Portlet.addPG(portletName = "Asset Publisher");

		WebContent.addPGViaAP(
			webContentContent = "This is the web content test for rss feed",
			webContentTitle = "Web Content Title"
		);

		Portlet.gotoPortletOptions(
			portletName = "Asset Publisher",
			portletOption = "Configuration"
		);

		AssetPublisherPortlet.enableRSSSubscription();

		Button.clickSave();

		IFrame.selectTopFrame();

		Navigator.gotoSitePage(
			pageName = "Asset Publisher Page",
			siteName = "Site Name"
		);

		var rssFeedUrl = selenium.getAttribute("//div[@class='subscribe-action']/span/a[contains(@href,'asset_publisher')]@href");

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		Portlet.gotoPortletOptions(
			portletName = "RSS Publisher",
			portletOption = "Configuration"
		);

		RSSPortlet.addFeed(
			feedRowIndexNumber = "0",
			feedTitle = "Web Asset Publisher",
			feedUrlLink = "${rssFeedUrl}"
		);

		PortletEntry.save();

		Navigator.gotoSitePage(pageName = "Site Page Name", siteName = "Site Name");

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Web Asset Publisher");

		RSSPortlet.viewUpdateFeedTitle(feedHeading = "Web Content Title");

		Navigator.gotoSitePage(
			pageName = "Asset Publisher Page",
			siteName = "Site Name"
		);

		WebContent.editPGViaAP(
			assetTitle = "Web Content Title",
			webContentContentEdit = "This is the updated version of web content test for rss feed",
			webContentTitleEdit = "Web Content Title Updated Feed"
		);

		RSSPortlet.viewUpdateFeedTitle(
			feedHeading = "Web Content Title Updated Feed",
			pageName = "Site Page Name",
			updateFeed = "true"
		);

		RSSPortlet.viewDisplayFeedTitle(feedTitle = "Web Asset Publisher");
	}
}