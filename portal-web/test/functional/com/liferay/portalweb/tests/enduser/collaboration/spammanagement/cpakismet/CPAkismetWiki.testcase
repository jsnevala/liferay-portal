@component-name = "portal-integrations"
@ignore = "true"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property portlet.plugins.includes = "akismet-portlet";
	property testray.main.component.name = "Akismet";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		WikiNode.addMainCP();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			WikiNode.tearDownCP();

			WikiPage.tearDownCP();

			User.tearDownCP();

			AkismetPortlet.tearDownConfiguration();
		}
	}

	@priority = "4"
	test MarkAsNotSpamWikiPage {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Apps",
			panel = "Control Panel",
			portlet = "Akismet"
		);

		AkismetPortlet.configure(enableSpamModerationFor = "Wiki");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editUserSiteCP(siteName = "${siteName}", userScreenName = "usersn");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Roles"
		);

		Role.definePermissionCmdCP(
			permissionDefinitionKey = "SITE_ADMIN_CONTENT_WIKI_GENERAL_PERMISSIONS_ACCESS_IN_SITE_ADMINISTRATION_CHECKBOX",
			permissionDefinitionValue = "Access in Site Administration",
			roleName = "Authenticated",
			roleUser = "User"
		);

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki"
		);

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoAllPagesCP();

		WikiPage.addCP(
			wikiPageContent = "Wiki Page Content",
			wikiPageTitle = "Wiki Page Title"
		);

		User.logoutPG();

		User.loginPG(password = "test", userEmailAddress = "test@liferay.com");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki"
		);

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoCP(
			wikiPageRevision = "1.0",
			wikiPageTitle = "Wiki Page Title",
			wikiPageUsername = "userfn userln"
		);

		WikiPage.markAsSpamCP(wikiPageRevision = "1.0");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Spam Moderation"
		);

		SpamModerationPortlet.navigateToWikis();

		SpamModerationPortlet.MarkAsNotSpam(
			assetType = "wikiPage",
			wikiPageRevision = "1.0",
			wikiPageTitle = "Wiki Page Title",
			wikiPageUsername = "userfn userln"
		);

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Spam Moderation"
		);

		SpamModerationPortlet.viewDefault(assetType = "wikiPage");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki"
		);

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoCP(
			wikiPageRevision = "1.0",
			wikiPageTitle = "Wiki Page Title",
			wikiPageUsername = "userfn userln"
		);

		WikiPage.viewCP(akismetEnabled = "true", wikiPageRevision = "1.0");
	}

	@priority = "4"
	test MarkAsSpamWikiPage {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Apps",
			panel = "Control Panel",
			portlet = "Akismet"
		);

		AkismetPortlet.configure(enableSpamModerationFor = "Wiki");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editUserSiteCP(siteName = "${siteName}", userScreenName = "usersn");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Roles"
		);

		Role.definePermissionCmdCP(
			permissionDefinitionKey = "SITE_ADMIN_CONTENT_WIKI_GENERAL_PERMISSIONS_ACCESS_IN_SITE_ADMINISTRATION_CHECKBOX",
			permissionDefinitionValue = "Access in Site Administration",
			roleName = "Authenticated",
			roleUser = "User"
		);

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki"
		);

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoAllPagesCP();

		WikiPage.addCP(
			wikiPageContent = "Wiki Page Content",
			wikiPageTitle = "Wiki Page Title"
		);

		User.logoutPG();

		User.loginPG(password = "test", userEmailAddress = "test@liferay.com");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Wiki"
		);

		WikiNavigator.gotoNode(wikiNodeName = "Main");

		WikiNavigator.gotoCP(
			wikiPageRevision = "1.0",
			wikiPageTitle = "Wiki Page Title",
			wikiPageUsername = "userfn userln"
		);

		WikiPage.markAsSpamCP(wikiPageRevision = "1.0");

		Navigator.openURL();

		ProductMenu.gotoPortlet(
			category = "Content",
			panel = "Site Administration",
			portlet = "Spam Moderation"
		);

		SpamModerationPortlet.navigateToWikis();

		SpamModerationPortlet.viewMarkedAsSpam(
			assetType = "wikiPage",
			wikiPageRevision = "1.0",
			wikiPageTitle = "Wiki Page Title",
			wikiPageUsername = "userfn userln"
		);
	}
}