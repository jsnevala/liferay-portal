@component-name = "portal-staging"
definition {
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Site and Page Templates";
	var siteTemplateName = "Site Template Name";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			Navigator.openURL();

			User.logoutAndLoginPG(
				password = "test",
				userLoginEmailAddress = "test@liferay.com",
				userLoginFullName = "Test Test"
			);

			User.tearDownCP();

			UserGroup.tearDownCP();

			Site.tearDownCP();

			SiteTemplates.tearDownCP();

			DMDocument.tearDownCP();
		}
	}

	@priority = "4"
	test AdminCanNotAddASubpageOfAChildPageLinkedToSiteTemplatePage {
		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addCP(
			siteTemplateActive = "Yes",
			siteTemplateName = "Site Template Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addSitePageViaSiteTemplateCP(
			pageName = "Site Page Name",
			siteTemplateName = "Site Template Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addChildPageViaSiteTemplateCP(
			childSitepageName = "true",
			pageName = "Site Page Name",
			siteChildPageName = "Site Child Page Name",
			siteTemplateName = "Site Template Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addSiteTemplateCP(
			siteName = "Site Name",
			siteTemplateName = "Site Template Name"
		);

		SitePageNavigator.gotoPages(page = "Public Pages", site = "Site Name");

		Page.viewNoDeletePagesAssociatedWithSiteTemplate(page = "Site Child Page Name");
	}

	@priority = "4"
	test EditSiteTemplateGuestPermissions {
		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addCP(siteTemplateName = "${siteTemplateName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addSiteTemplateCP(
			siteName = "Site Name",
			siteTemplateName = "Site Template Name"
		);

		PermissionsInline.gotoSiteTemplateCP(page = "home");

		Role.removePermissionPG(
			permissionDefinitionKey = "CONTENT_PERMISSIONS_VIEW_CHECKBOX",
			roleName = "Guest"
		);

		Navigator.gotoSitePage(pageName = "home", siteName = "Site Name");

		PermissionsInline.gotoSiteTemplateCP(page = "home");

		Role.definePermissionPG(
			permissionDefinitionKey = "CONTENT_PERMISSIONS_VIEW_CHECKBOX",
			roleName = "Guest"
		);
	}

	@priority = "4"
	test PortletPreferencesPersistWithSiteTemplateWhenSamePortletAddedOnSecondPage {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addCP(siteTemplateName = "Site Template Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addSitePageViaSiteTemplateCP(
			pageName = "Page1 Name",
			siteTemplateName = "Site Template Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplatesNavigator.gotoSiteTemplatesPageLowercase(
			pageName = "Page1 Name",
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		Portlet.addPG(defaultURL = "false", portletName = "Hello World");

		Close.closeWindow(locator1 = "title=home - Site Template Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addSitePageViaSiteTemplateCP(
			pageName = "Page2 Name",
			siteTemplateName = "Site Template Name"
		);

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		Site.addSiteTemplateCP(
			siteName = "Site Name",
			siteTemplateName = "Site Template Name"
		);

		Navigator.gotoSitePage(pageName = "Page1 Name", siteName = "Site Name");

		PermissionsInline.gotoConfigurationPG(
			portletName = "Hello World",
			portletOption = "Permissions"
		);

		Role.removePermissionPG(
			permissionDefinitionKey = "CONTENT_PERMISSIONS_VIEW_CHECKBOX",
			roleName = "Guest"
		);

		Refresh();

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		AssertClick(locator1 = "Home#PAGE_TEMPLATE_3", value1 = "Page2 Name");

		Portlet.addPG(defaultURL = "false", portletName = "Hello World");

		Navigator.gotoSitePage(pageName = "Page1 Name", siteName = "Site Name");

		PermissionsInline.gotoConfigurationPG(
			portletName = "Hello World",
			portletOption = "Permissions"
		);

		Role.viewPermissionPG(
			permissionDefinitionKey = "CONTENT_PERMISSIONS_VIEW_CHECKBOX",
			permissionFlagged = "false",
			roleName = "Guest"
		);
	}

	@ignore = "true"
	@priority = "3"
	test SiteAdminCannotDeletePagesThatWereCreatedBySiteTemplates {
		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "User Groups"
		);

		UserGroup.addCP(
			selectSiteTemplate = "true",
			siteTemplateName = "Community Site",
			userGroupName = "UG UserGroup Name"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "User Groups"
		);

		LexiconEntry.gotoEllipsisMenuItem(menuItem = "Manage Pages");

		for (var page : list "Home,Wiki") {
			ProductMenu.gotoSiteViaLink(site = "UG UserGroup Name");

			Page.viewNoDeletePagesAssociatedWithSiteTemplate(page = "${page}");
		}
	}

	@priority = "4"
	test SitesDynamicTemplateInheritance {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Sites"
		);

		LexiconEntry.gotoHeaderMenuItem(menuItem = "Manage Sites Templates");

		SiteTemplates.viewDefaultCP(
			siteTemplateNameList = "Intranet Site,Community Site"
		);

		SiteTemplates.addCP(siteTemplateName = "Site Template Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		Portlet.addPG(portletName = "Message Boards");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editUserSiteCP(siteName = "${siteName}", userScreenName = "usersn");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.assignRegularRoleCP(roleName = "Administrator", userScreenName = "usersn");

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "User Groups"
		);

		UserGroup.addCP(
			selectSiteTemplate = "true",
			siteTemplateName = "Site Template Name",
			userGroupName = "UG UserGroup Name"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "User Groups"
		);

		UserGroup.viewPG(
			pageName = "home",
			portletName = "Message Boards",
			siteName = "${siteName}",
			userGroupName = "UG UserGroup Name"
		);

		User.firstLoginPG(password = "test", userEmailAddress = "test@liferay.com");
	}

	@priority = "3"
	test SitesTemplateResourceInheritance {
		property osgi.app.includes = "tasks";
		property plugins.deployment.type = "osgi";

		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addCP(siteTemplateName = "Site Template Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		Portlet.addPG(portletName = "Documents and Media");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		DMDocument.addPG(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.png",
			dmDocumentTitle = "Document_1.png"
		);

		Portlet.addPG(portletName = "Tasks");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addCP(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.addPersonalSiteCP(
			siteTemplateName = "Site Template Name",
			userScreenName = "usersn"
		);

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations"
		);

		User.editPasswordCP(
			userEmailAddress = "userea@liferay.com",
			userScreenName = "usersn"
		);

		User.firstLoginPG(password = "test", userEmailAddress = "userea@liferay.com");

		UserBar.gotoDashboard();

		DMDocument.viewPG(
			dmDocumentDescription = "DM Document Description",
			dmDocumentFile = "Document_1.png",
			dmDocumentTitle = "Document_1.png"
		);

		Tasks.addTask(
			dueDate = "true",
			taskAssignee = "userfn userln",
			taskDescription = "Review Tests",
			taskReporter = "userfn userln"
		);

		User.firstLoginPG(password = "test", userEmailAddress = "test@liferay.com");
	}

	@priority = "3"
	test ViewInlineGuestPermissionsInSiteTemplatesViaWCD {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.addCP(siteTemplateName = "Site Template Name");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		Portlet.addPG(defaultURL = "false", portletName = "Web Content Display");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Site Templates"
		);

		SiteTemplates.gotoViewPages(
			siteName = "${siteName}",
			siteTemplateName = "Site Template Name"
		);

		PermissionsInline.gotoConfigurationPG(portletName = "Web Content Display");

		Role.viewPermissionPG(
			permissionDefinitionKey = "CONTENT_PERMISSIONS_VIEW_CHECKBOX",
			permissionFlagged = "true",
			roleName = "Guest"
		);
	}

	@priority = "3"
	test ViewNoAddPageTabViaPageTemplatesCP {
		var siteName = TestCase.getSiteName(siteName = "${siteName}");

		ProductMenu.gotoPortlet(
			category = "Sites",
			panel = "Control Panel",
			portlet = "Page Templates"
		);

		PageTemplate.gotoPageTemplateViaEdit(pageTemplateName = "Wiki");

		SelectWindow(locator1 = "title=Wiki - ${siteName}");

		Dockbar.viewAddTabsWithNoAddPagePermission();
	}
}